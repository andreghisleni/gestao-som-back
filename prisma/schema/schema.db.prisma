// --- MÓDULO DE LOCAÇÃO (RENTAL) ---

model Category {
  id            String @id @default(cuid())
  name          String @unique // Ex: "Som", "Iluminação"
  rentalPercent Float  @map("rental_percent") // Mantemos Float para % (ex: 4.0)

  equipments Equipment[]

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("categories")
}

model Equipment {
  id   String @id @default(cuid())
  name String

  categoryId String   @map("category_id")
  category   Category @relation(fields: [categoryId], references: [id])

  // USANDO DECIMAL (Precision 10, Scale 2 -> até 99.999.999,99)
  purchasePrice Decimal  @map("purchase_price") @db.Decimal(10, 2)
  rentalPrice   Decimal? @map("rental_price") @db.Decimal(10, 2)

  stockQuantity Int @default(1) @map("stock_quantity")

  budgetItems BudgetItem[]

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  user      User?    @relation(fields: [userId], references: [id])
  userId    String?

  @@map("equipments")
}

model Budget {
  id         String   @id @default(cuid())
  clientName String   @map("client_name")
  eventDate  DateTime @map("event_date")
  status     String   @default("DRAFT")

  // TOTAIS EM DECIMAL
  totalValue    Decimal @default(0) @map("total_value") @db.Decimal(10, 2)
  discount      Decimal @default(0) @db.Decimal(10, 2)
  laborCost     Decimal @default(0) @map("labor_cost") @db.Decimal(10, 2)
  transportCost Decimal @default(0) @map("transport_cost") @db.Decimal(10, 2)
  finalValue    Decimal @default(0) @map("final_value") @db.Decimal(10, 2)

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  userId String @map("user_id")
  user   User   @relation(fields: [userId], references: [id])

  sections BudgetSection[]

  @@map("budgets")
}

model BudgetSection {
  id   String @id @default(cuid())
  name String // Ex: "Cerimônia"

  budgetId String @map("budget_id")
  budget   Budget @relation(fields: [budgetId], references: [id], onDelete: Cascade)

  items BudgetItem[]

  @@map("budget_sections")
}

model BudgetItem {
  id          String        @id @default(cuid())
  sectionId   String        @map("section_id")
  section     BudgetSection @relation(fields: [sectionId], references: [id], onDelete: Cascade)
  equipmentId String        @map("equipment_id")
  equipment   Equipment     @relation(fields: [equipmentId], references: [id])

  quantity Int

  // Snapshot do preço
  unitPrice Decimal @map("unit_price") @db.Decimal(10, 2)
  subtotal  Decimal @db.Decimal(10, 2)

  @@map("budget_items")
}
